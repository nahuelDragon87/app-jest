import { existsSync, lstatSync } from "node:fs";
import { dirname, extname, resolve } from "node:path";
function fullySpecifyCommonJS(api) {
  return api.assertVersion(7), {
    name: "babel-plugin-fully-specified-cjs",
    visitor: {
      CallExpression(path, state) {
        var callee = path.get("callee");
        if (callee.isIdentifier({
          name: "require"
        }) && path.node.arguments.length === 1) {
          var arg = path.node.arguments[0];
          if (arg.type === "StringLiteral") {
            var moduleSpecifier = arg.value;
            if (moduleSpecifier.startsWith(".") || moduleSpecifier.startsWith("/")) {
              var filePath = state.file.opts.filename;
              if (!filePath) return;
              var fileDir = dirname(filePath), cjsExtension = ".cjs", jsExtension = ".js";
              if (!extname(moduleSpecifier)) {
                var resolvedPath = resolve(fileDir, moduleSpecifier), newModuleSpecifier = moduleSpecifier;
                if (isLocalDirectory(resolvedPath)) {
                  var indexPath = resolve(resolvedPath, "index" + jsExtension);
                  if (existsSync(indexPath)) {
                    newModuleSpecifier.endsWith("/") || (newModuleSpecifier += "/"), newModuleSpecifier += "index" + cjsExtension, arg.value = newModuleSpecifier;
                    return;
                  }
                }
                var filePathWithJs = resolvedPath + jsExtension;
                if (existsSync(filePathWithJs)) {
                  newModuleSpecifier += cjsExtension, arg.value = newModuleSpecifier;
                  return;
                }
              }
            }
          }
        }
      }
    }
  };
}
function isLocalDirectory(absolutePath) {
  return existsSync(absolutePath) && lstatSync(absolutePath).isDirectory();
}
export {
  fullySpecifyCommonJS as default
};
//# sourceMappingURL=commonjs.js.map
